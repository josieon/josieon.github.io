---
layout: post
title: Node.js
---

# Node.js란?

노드 공식 사이트에는 노드를 다음과 같이 설명하고 있다.

> Node.js는 Chrome V8 JavaScript 엔진으로 빌드 된 JavaScript 런타임이다.

즉, 노드를 통해 다양한 자바스크립트 애플리케이션을 실행할 수 있으며, 서버를 실행하는 데 제일 많이 사용된다.

- Node.js는 JavaScript를 서버에서도 사용할 수 있도록 만든 프로그램이다.
- Node.js는 V8이라는 javaScript 엔진 위에 동작하는 자바스크립트 런타임(환경)이다.
- Node.js는 서버사이트 스크립트 언어가 아니다. 프로그램(환경)이다.
- Node.js는 웹서버와 같이 확장성 있는 네트워크 프로그램을 제작하기 위해 만들어졌다.

Node.js는 확장성이 있는 네트워크 어플리케이션 개발에 사용되는 소프트웨어 플랫폼이다. 특히 서버사이트에서 많이 사용되고 있다.  
사용되는 언어로는 JavaScript를 활용하며, Non-blocking I/O와 단일 스레드 이벤트 루프를 통한 높은 처리 성능을 가지고 있는 것이 특징이다.

내장 HTTP 서버 라이브러리를 포함하고 있어 웹 서버에서 아파치 등의 별도 소프트웨어 없이 동작하는 것이 가능하며, 이를 통한 웹 서버의 동작에 있어 더 많은 통제에서 벗어나 여러 가지 기능을 가능하게 한다.

즉, Node.js를 통해 웹 어플리케이션이 더욱 발전하게 되었으며, 정적인 홈페이지 뿐만 아니라 쇼핑몰, 티켓 예매사이트, 블로그 등 데이터가 변해가는 사이트를 만들 수 있으며, 여러 개발자가 만든 프로그램과 게임을 웹상에서 구동시켜 안드로이드폰, 아이폰, 윈도우PC, 맥 등 플랫폼의 제약에서 벗어나 어디든 상관없이 실행 가능하게 해준다.

물론 단순히 웹에서 실행 가능한 게임을 만들려면 JavaScript만으로도 가능하지만 좀 더 진화된 프로그램으로 실시간 온라인 채팅, 실시간 온라인 게임 등 실시간 기능을 넣건, 로그인 기능을 넣어 유저를 관리하고 점수를 관리하는 데이터베이스 기능을 Node.js를 통해 만들 수가 있다.

# Node.js 사용이유

- Node.js를 사용하려면 먼저 JavaScript를 배워야한다.
- Node.js는 JavaScript를 사용하기 위해 만들어진 것이기 때문이다.
- JavaScript는 프로그래밍 언어이다.
- 이름에서 알 수 있듯 JavaScript는 독립적인 언어가 아니라 스크립트 언어다.
- 스크립트 언어는 특정한 프로그램 안에서 동작하는 언어이기 때문에 웹 브라우저 안에서만 동작을 한다.
- 그러나, JavaScript를 웹 브라우저에서 독립시킨 것으로 Node.js를 설치하게 되면 터미널 프로그램에서 Node.js를 입력하여 브라우저 없이 바로 실행할 수 있다.
- Node.js를 이용해 서버를 만들 수 있다는 점이 중요한데 그 이유는 이전까지 Server-Client 웹사이트를 만들 때 웹에서 표시되는 부분은 JavaScript를 사용하여 만들어야만 했으며, 서버는 Java 등 다른 언어를 써서 만들어야 했는데, 이제는 한 가지 언어로 전체 웹 페이지를 만들 수 있게 되었다.

# JavaScript Runtime

- 런타임이란 특정 언어로 만든 프로그램을 실행할 수 있는 환경을 뜻한다.
- 따라서 노드는 자바스크립트 프로그램을 컴퓨터에서 실행할 수 있게 하는 자바스크립트 실행기이다.

# 이벤트 기반

- 노드는 V8과 더불어 libuv라는 라이브러리를 사용한다.
- libuv 라이브러리는 노드의 특성인 이벤트 기반, 논 블로킹 I/O 모델을 구현하고 있다.
- 이벤트 기반(Event-drive)이란 이벤트가 발생할 때 미리 지정해둔 작업을 수행하는 방식을 의미한다.
- 즉, 이벤트 기반 시스템에서는 특정 이벤트가 발생할 때 무엇을 할지 미리 등록해두고, 이를 이벤트 리스너에 콜백함수를 등록한다.
- 이후 이벤트가 발생하면 리스너에 등록해둔 콜백함수를 호출하며, 이벤트가 끝난 후 노드는 다음 이벤트가 발생할 때까지 대기한다.

#Node.js의 내부 구조

![](https://miro.medium.com/v2/resize:fit:720/format:webp/1*yEW6321eqBd_-C0D7LsBQw.png)

> Node.js는 JavaScript와 C++로 구성되어 있다. V8엔진도 70% 이상의 C++로 구성되어 있으며, libuv는 100%의 C++로 구성된 라이브러리다. V8 엔진에서 JavaScript를 C++로 Translate해주고 Node.js의 코어 라이브러리는 process.binding()을 통해 JavaScript 환경에서 사용될 수 있다.  
>  
> Node.js에 동작하는 이벤트루프는 libuv 내에서 구현된다. 이벤트 루프가 libuv 내에서 실행된다고 해서, JavaScript의 스레드와 이벤트 루프의 스레드가 별도로 존재한다고 생각할 수 있지만, Node.js는 싱글스레드이기 때문에 하나의 이벤트 루프를 가지며 하나의 스레드가 모든 것을 처리한다.

# 이벤트 루프

- 이벤트 루프는 여러 이벤트가 동시에 발생했을 때 어떤 순서로 콜백함수를 호출 할지를 이벤트 루프가 판단한다.
- 노드는 이벤트가 종료될 때까지 이벤트 처리를 위한 작업을 반복하므로 루프라고 부른다.
- 이벤트 루프는 여러 개의 페이즈(Phase)들을 가지고 있으며, 해당 페이즈들은 각자만의 큐를 갖는다.
- 이벤트 루프는 라운드 로빈 방식으로 노드 프로세스가 종료될때까지 일정 규칙에 따라 여러개의 페이즈들을 계속 순회한다.
- 페이즈들은 각각의 큐들을 관리하고, 해당 큐들은 FIFO 순서로 콜백함수들을 처리한다.

![](https://i0.wp.com/hanamon.kr/wp-content/uploads/2021/01/%EB%85%B8%EB%93%9C-%EC%9D%B4%EB%B2%A4%ED%8A%B8%EB%A3%A8%ED%94%84.png?resize=768%2C396&ssl=1)

# 논 블로킹 I/O

- 이벤트 루프를 잘 활용하면 오래 걸리는 작업을 효율적으로 처리할 수 있다.
- 작업에는 두가지 종류가 있는데 동시에 실행될 수 있는 작업과 동시에 실행될 수 없는 작업이다.
- 특히 파일 시스템 접근, 네트워크를 통한 요청 작업은 Input/Output의 일종이며,
- 이러한 작업을 할 때 노드는 비동기 방식(Async)으로 블로킹을 만들지 않게 끔(Non Blocking) 처리한다.
- 비동기(Async)란 이전 작업이 완료될 때까지 대기하지 않고 동시에 작업을 수행한다.
- 반대로 동기(Sync)는 이전 작업이 끝나야만 다음 작업을 수행한다.
- 자세하게 풀어서 이야기하면 함수 호출 시 당장 실행하는 것이 아니라(동기→블로킹) 일단 어느 곳에 쌓아 놓고 동시에 요청을 처리하고(비동기→논 블로킹) 요청이 완료된 순서대로 처리(스택 이용)한다는 말이다.

# 싱글 스레드

이벤트 기반, 논 블로킹 모델과 더불어 노드를 설명하는 키워드 중 하나는 싱글 스레드이다.  
자바스크립트 코드는 동시에 실행될 수 없는데 그 이유는 노드가 싱글 스레드 기반이기 때문이다.

- __프로세스__: 운영체제에서 할당하는 작업의 단위이다. 노드나 웹 브라우저 같은 프로그램은 개별적인 프로세스이다. 프로세스 간에는 메모리 자원 등의 자원을 공유하지 않는다.
- __스레드__: 스레드는 프로세스 내에서 실행되는 흐름의 단위이다. 프로세스는 여러 개 생성해 여러 작업을 동시에 처리할 수 있다. 스레드들은 부모 프로세스의 자원을 공유한다. 같은 주소의 메모리에 접근 가능하므로 데이터를 공유할 수 있다.

Node.js는 싱글스레드, 논 블로킹 모델로 싱글 스레드가 혼자서 일을 처리하지만 들어오는 요청 순서가 아닌 Async Non Blocking 방식으로 이전 작업이 완료될 때까지 대기하지 않고 다음 작업을 수행한다.

# 결론

노드는 기본적으로 싱글 스레드, 논 블로킹 모델을 채용하므로 I/O 요청이 많이 발생하면 노드를 서버로 사용하는 것이 좋다.  
하지만 노드는 CPU 부하가 큰 작업에는 적합하지 않다.

우리가 작성하는 코드는 모두 스레드 하나에서 처리되기 때문에 코드가 CPU 연산을 많이 요구하면 스레드 하나가 혼자서 감당하기 어렵다.

즉, 개수는 많지만 크기는 작은 데이터를 실시간으로 주고받는데 노드는 적합하다. 예를 들어 네트워크나 데이터베이스, 디스크 작업 같은 I/O에 특화되어 있다. 실시간 채팅 어플리케이션, 주식 차트도 포함된다.

결론적으로 노드의 장점은 1) 멀티 스레드 방식에 비해 적은 컴퓨터 자원을 사용한다. 2) I/O 작업이 많은 서버로 적합하다. 3) 웹 서버가 내장되어 있어 별도의 웹서버를 설치할 필요가 없다. 4) JavaScript를 사용하기 때문에 JSON 형식과 쉽게 호환된다.

# Node.js의 FrameWork Express

- Express는 Node.js의 프레임워크이다.
- 프레임워크는 어떠한 작업을 쉽게 완성하기 위한 라이브러리의 집합이라고 할 수 있다.
- 작업을 시작부터 끝까지 라이브러리로 지원한다는 점이 단순한 라이브러리와 차이가 나는 부분이다.
- 예를 들면 jQuery는 JavaScript 라이브러리로 다양한 용도를 가지고 있지만, jQuery 자체가 무엇 하나를 이루기 위한 목적을 가지고 있지는 않다.
- Express는 Node.js를 이용하여 웹 어플리케이션을 만들기 위한 틀(Frame)을 제공하는 라이브러리의 집합이다.
- 현재 JavaScript는 GitHub에서 사용률 1위인 언어이며, 이는 Node.js의 덕이 크다고 할 수 있다.

#### 출처

https://hanamon.kr/nodejs-%EA%B0%9C%EB%85%90-%EC%9D%B4%ED%95%B4%ED%95%98%EA%B8%B0/